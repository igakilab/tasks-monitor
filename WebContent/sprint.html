<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title>Sprint</title>

		<link href="css/bootstrap.min.css" rel="stylesheet"/>
		<link href="css/bootstrap-datepicker3.css" rel="stylesheet"/>
	</head>
	<body style="padding-top: 50px;">
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collabpsed"
					data-toggle="collapse" data-target="#navbar"
					aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">Tasks Monitor</a>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#">home</a></li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="container">
			<div style="padding: 40px 15px; text-align: center;">
				<div class="row">
					<div class="col-md-9 text-left">
						<h2>スプリントの登録 <small class="regist-type">読み込み中...</small></h2>
					</div>
				</div>

				<div class="row alert-div"></div>

				<div class="row row-eq-height">
					<form class="form-horizontal">
						<div class="form-group">
							<h3 class="col-sm-2">目標日</h3>
							<div class="col-sm-10">
								<input class="form-control datepicker"
									id="finishDateInput" placeholder="yyyy/mm/dd"
									style="margin-top: 15px;"/>
							</div>
						</div>
					</form>
				</div>

				<div class="row">
					<div class="col-md-5">
						<h2>ToDo未登録タスク</h2>
						<table id="non-assign" class="table" style="text-align: left">
							<thead><tr>
								<th>
									タスク名
								</th>
								<th></th>
							</tr></thead>
							<tbody class="unselected-card-list">
							<!-- <tr>
								<td>
									ああああああああああ
								</td>
								<td>
									<button class="btn btn-primary btn-sm" style="float:right">
										移動
										<span class="glyphicon glyphicon-arrow-right" aria-hidden="true">
										</span>
									</button>
								</td>
							</tr>
							<tr>
								<td>
									いいいいいいいいいい
								</td>
								<td>
									<button class="btn btn-primary btn-sm" style="float:right">
										移動
										<span class="glyphicon glyphicon-arrow-right" aria-hidden="true">
										</span>
									</button>
								</td>
							</tr> -->
							</tbody>
						</table>
					</div>
					<div class="col-md-7">
						<h2>登録済タスク</h2>
						<table id="assigned" class="table" style="text-align: left">
							<thead><tr>
								<th></th>
								<th>
									タスク名
								</th>
								<th>
									担当者
								</th>
							</tr></thead>
							<tbody class="selected-card-list">
							<!-- <tr>
								<td>
									<button class="btn btn-danger btn-sm">
										<span class="glyphicon glyphicon-arrow-left" aria-hidden="true">
										</span>取消
									</button>
								</td>
								<td>
									うううううううううう
								</td>
								<td>
									<div class="btn-group" role="group" aria-label="...">
										<button type="button" class="btn btn-default btn-sm">member1</button>
										<button type="button" class="btn btn-primary btn-sm">member2</button>
										<button type="button" class="btn btn-default btn-sm">member3</button>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<button class="btn btn-danger btn-sm">
										<span class="glyphicon glyphicon-arrow-left" aria-hidden="true">
										</span>取消
									</button>
								</td>
								<td>
									ええええええええええ
								</td>
								<td>
									<div class="btn-group" role="group" aria-label="...">
										<button type="button" class="btn btn-default btn-sm">member1</button>
										<button type="button" class="btn btn-default btn-sm">member2</button>
										<button type="button" class="btn btn-primary btn-sm">member3</button>
									</div>
								</td>
							</tr> -->
							</tbody>
						</table>
					</div>
				</div>

				<div class="row text-right">
					<button type="button" class="btn btn-default to-dashboard-btn">
					ダッシュボードへ戻る</button>
					<button type="button" class="btn btn-success create-btn">
					スプリント開始</button>
				</div>
			</div>
		</div>

		<div class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">担当者編集</h4>
					</div>
				<div class="modal-body">
					<p>One fine body&hellip;</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootstrap-datepicker.js"></script>
		<script src="js/bootstrap-datepicker.ja.min.js"></script>
		<script src="js/util.js"></script>
		<script src="js/sprint-builder.js"></script>
		<script src="dwr/engine.js"></script>
		<script src="dwr/util.js"></script>
		<script src="dwr/interface/SprintPlanner.js"></script>
		<script src="sprint.js"></script>
		<script>$(document).ready(function(){
			//ボードidを取得
			var boardId = Util.getUrlParameters().bid;

			if( Util.isNull(boardId) ){
				Util.showAlertToDiv("ボードIDを指定してください");
				return;
			}

			//datepickerを初期化
			$(".datepicker").datepicker({
				language:"ja",
				format:"yyyy/mm/dd"
			});

			//仮の目標日を設定
			var dt = new Date();
			dt.setDate(dt.getDate() + 7);
			$("#finishDateInput").val(Util.formatDate(dt, "YYYY/MM/DD"));

			//エラーハンドラーを設定
			SprintBuilder.defaultErrorHandler = function(msg){
				Util.showAlertToDiv(msg);
			};

			//スプリントのデータを取得
			var builder = new SprintBuilder(boardId);
			builder.fetch(function(){
				setCardList(builder);
				if( builder.getCurrentSprint() != null ){
					$(".regist-type").text("変更(ID: " + builder.getCurrentSprint().id + ")");
					$(".create-btn").text("変更を保存");
					$("#finishDateInput").val(Util.formatDate(builder.getFinishDate(), "YYYY/MM/DD"));
				}else{
					$(".regist-type").text("新規");
					$(".create-btn").text("イテレーション開始");
				}
			});

			//新規作成ボタンを設定
			$(".create-btn").on('click', function(){
				//ボタン処理
				$(".create-btn").off('click')
					.text("処理中...").addClass("disabled");
				//日付のパース
				var ds = $("#finishDateInput").val();
				var fd = Date.parse(ds);
				//フォーマット確認
				if( isNaN(fd) ){
					Util.showAlertToDiv("無効な目標日です: " +
						ds + " (yyyy/mm/dd形式で入力してください)");
					return;
				}

				builder.setFinishDate(fd);

				builder.regist(function(sid){
					location.href = "index.html?bid=" + boardId;
				});
			});

			//ダッシュボードへ移動ボタンを設定
			$(".to-dashboard-btn").on('click', function(){
				location.href = "index.html?bid=" + boardId;
			});
		});

		</script>
	</body>
</html>