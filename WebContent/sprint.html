<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title>top page</title>

		<link href="css/bootstrap.min.css" rel="stylesheet"/>
	</head>
	<body style="padding-top: 50px;">
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collabpsed"
					data-toggle="collapse" data-target="#navbar"
					aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">Project name</a>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#">home</a></li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="container">
			<div style="padding: 40px 15px; text-align: center;">
				<div class="row">
					<div class="col-md-3">
						<h2>スプリントの登録</h2>
					</div>
				</div>

				<div class="row row-eq-height">
					<form class="form-horizontal">
						<div class="form-group">
							<h3 class="col-sm-2">目標日</h3>
							<div class="col-sm-10">
								<input type="email" class="form-control"
									id="inputEmail3" placeholder="yyyy/mm/dd" style="margin-top: 15px;"/>
							</div>
						</div>
					</form>
				</div>

				<div class="row">
					<div class="col-md-5">
						<h2>ToDo未登録タスク</h2>
						<table id="non-assign" class="table" style="text-align: left">
							<thead><tr>
								<th>
									タスク名
								</th>
								<th></th>
							</tr></thead>
							<tbody class="unselected-card-list">
							<tr>
								<td>
									ああああああああああ
								</td>
								<td>
									<button class="btn btn-primary btn-sm" style="float:right">
										移動
										<span class="glyphicon glyphicon-arrow-right" aria-hidden="true">
										</span>
									</button>
								</td>
							</tr>
							<tr>
								<td>
									いいいいいいいいいい
								</td>
								<td>
									<button class="btn btn-primary btn-sm" style="float:right">
										移動
										<span class="glyphicon glyphicon-arrow-right" aria-hidden="true">
										</span>
									</button>
								</td>
							</tr>
							</tbody>
						</table>
					</div>
					<div class="col-md-7">
						<h2>登録済タスク</h2>
						<table id="assigned" class="table" style="text-align: left">
							<thead><tr>
								<th></th>
								<th>
									タスク名
								</th>
								<th>
									担当者
								</th>
							</tr></thead>
							<tbody class="selected-card-list"><tr>
								<td>
									<button class="btn btn-danger btn-sm">
										<span class="glyphicon glyphicon-arrow-left" aria-hidden="true">
										</span>取消
									</button>
								</td>
								<td>
									うううううううううう
								</td>
								<td>
									<div class="btn-group" role="group" aria-label="...">
										<button type="button" class="btn btn-default btn-sm">member1</button>
										<button type="button" class="btn btn-primary btn-sm">member2</button>
										<button type="button" class="btn btn-default btn-sm">member3</button>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<button class="btn btn-danger btn-sm">
										<span class="glyphicon glyphicon-arrow-left" aria-hidden="true">
										</span>取消
									</button>
								</td>
								<td>
									ええええええええええ
								</td>
								<td>
									<div class="btn-group" role="group" aria-label="...">
										<button type="button" class="btn btn-default btn-sm">member1</button>
										<button type="button" class="btn btn-default btn-sm">member2</button>
										<button type="button" class="btn btn-primary btn-sm">member3</button>
									</div>
								</td>
							</tr></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">担当者編集</h4>
					</div>
				<div class="modal-body">
					<p>One fine body&hellip;</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/util.js"></script>
		<script src="js/sprint-builder.js"></script>
		<script src="dwr/engine.js"></script>
		<script src="dwr/util.js"></script>
		<script src="dwr/interface/SprintPlanner.js"></script>
		<script>
		var SPRINT_BUILDER;

		function generateMemberAssignButtonGroup(card, builder){
			var bgroup = $("<div></div>").addClass("btn-group");
			var members = builder.getBoardMembers();
			console.log(members);
			for(var i=0; i<members.length; i++){
				var claz = "btn btn-sm";
				var onClick = null;
				if( builder.isMemberRegisted(card.id, members[i].id) ){
					claz = claz + " btn-primary active";
					onClick = function(){alert("member removed " + card.id + " " + members[i].id)}
				}else{
					claz = claz + " btn-default";
					onClick = function(){alert("member added " + card.id + " " + members[i].id)}
				}

				bgroup.append($("<button></button>").addClass(claz)
					.on('click', onClick)
					.text(members[i].name));
			}
			return bgroup;
		}

		function generateSelectedCardRow(card, builder){
			return $("<tr></tr>").append(
				$("<td></td>").append($("<button></button>").addClass("btn btn-sm btn-danger")
					.on('click', function(){
						alert("unselect button pressed" + card.id);
					})
					.append(Util.bsGlyphicon("arrow-left"), "取消")),
				$("<td></td>").text(card.name),
				$("<td></td>").append(generateMemberAssignButtonGroup(card, builder))
			);
		}

		function generateUnselectedCardRow(card){
			return $("<tr></tr>").append(
				$("<td></td>").text(card.name),
				$("<td></td>").append(
					$("<button></button>").on('click', function(){
						alert("select button pressed" + card.id);
					}).append("移動", Util.bsGlyphicon("arrow-right"))
					.addClass("btn btn-sm btn-primary"))
			);
		}

		function reloadCardList(){
			var unselected = SPRINT_BUILDER.getUnselectedCards();
			$(".unselected-card-list").empty();
			console.log(unselected);
			for(var i=0; i<unselected.length; i++){
				$(".unselected-card-list").append(
					generateUnselectedCardRow(unselected[i]));
			}

			var selected = SPRINT_BUILDER.getSelectedCards();
			$(".selected-card-list").empty();
			for(var i=0; i<selected.length; i++){
				$(".selected-card-list").append(
					generateSelectedCardRow(selected[i], SPRINT_BUILDER));
			}
		}

		$(document).ready(function(){
			var boardId = Util.getUrlParameters().boardId;
			console.log(boardId);
			if( !Util.isNull(boardId) ){
				SPRINT_BUILDER = new SprintBuilder(boardId);
				SPRINT_BUILDER.fetch(function(){
					console.log(SPRINT_BUILDER);
					reloadCardList();
				});
			}
		});

		</script>
	</body>
</html>